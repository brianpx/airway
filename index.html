<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VSLO Application Processing System</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <style>
    @keyframes slideIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }
    @keyframes pulse { 0%,100% {opacity:1;} 50% {opacity:.5;} }
    .animate-slide-in { animation: slideIn .3s ease-out; }
    .animate-pulse-slow { animation: pulse 2s cubic-bezier(0.4,0,0.6,1) infinite; }
    .gradient-bg { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); }
    .glass-morphism { background: rgba(255,255,255,.95); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,.2); }
    .hover-lift { transition: all .3s cubic-bezier(0.4,0,0.2,1); }
    .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 20px 25px -5px rgba(0,0,0,.1), 0 10px 10px -5px rgba(0,0,0,.04); }
  /* New styles for drag-and-drop feedback */
    .drag-over-valid { border: 2px solid #10b981 !important; background-color: #ecfdf5 !important; }
    .drag-over-invalid { border: 2px solid #ef4444 !important; background-color: #fef2f2 !important; }
    .dragging { 
      border: 2px solid #8b5cf6 !important; 
      background-color: white !important;
      border-radius: 0.5rem !important;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
    }
    .drag-active {
      border: 2px solid #a78bfa !important;
      background-color: white !important;
      border-radius: 0.5rem !important;
      cursor: move !important;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script type="text/babel" data-presets="env,react">
    const { useState, useEffect, useRef, Fragment } = React;
    /* Icons (unchanged) */
    const FileUploadIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="12" y1="18" x2="12" y2="12"></line>
        <line x1="9" y1="15" x2="15" y2="15"></line>
      </svg>
    );
    const ProcessIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
      </svg>
    );
    const ChartIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <line x1="18" y1="20" x2="18" y2="10"></line>
        <line x1="12" y1="20" x2="12" y2="4"></line>
        <line x1="6" y1="20" x2="6" y2="14"></line>
      </svg>
    );
    const TableIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="3" y1="9" x2="21" y2="9"></line>
        <line x1="9" y1="21" x2="9" y2="9"></line>
        <line x1="15" y1="21" x2="15" y2="9"></line>
      </svg>
    );
    const CalendarIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );
    const DownloadIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );
    const ShieldIcon = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        <path d="M9 12l2 2 4-4"></path>
      </svg>
    );
    const ChevronLeft = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
    );
    const ChevronRight = () => (
      <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
    );
    const TabButton = ({ icon, label, tabKey, activeTab, setActiveTab }) => (
      <button
        onClick={() => setActiveTab(tabKey)}
        className={`flex items-center justify-center sm:justify-start space-x-2 px-4 sm:px-6 py-3 rounded-lg transition-all duration-200 hover-lift
          w-full sm:w-auto
          ${activeTab === tabKey ? 'bg-white text-purple-600 shadow-lg' : 'bg-white/20 text-white hover:bg-white/30'}`}
      >
        {icon}
        <span className="font-medium">{label}</span>
      </button>
    );
    const ApplicantCard = ({ applicant, onSelect }) => (
      <div
        className="glass-morphism rounded-lg p-4 hover-lift cursor-pointer animate-slide-in"
        onClick={() => onSelect(applicant)}
        onDoubleClick={() => onSelect(applicant)}
      >
        <div className="flex justify-between items-start mb-3">
          <div className="min-w-0">
            <h3 className="font-semibold text-gray-800 truncate">{applicant.name}</h3>
            <p className="text-sm text-gray-600 truncate">{applicant.email}</p>
          </div>
          <span className={`px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap
            ${applicant.recommendation === 'Strong Accept' ? 'bg-green-100 text-green-800' :
              applicant.recommendation === 'Accept' ? 'bg-blue-100 text-blue-800' :
              applicant.recommendation === 'Hold' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
            {applicant.recommendation}
          </span>
        </div>
        <div className="grid grid-cols-2 gap-2 text-sm">
          <div><span className="text-gray-500">Step 1:</span><span className="ml-2 font-medium">{applicant.step1 ?? 'N/A'}</span></div>
          <div><span className="text-gray-500">Step 2:</span><span className="ml-2 font-medium">{applicant.step2 ?? 'N/A'}</span></div>
          <div><span className="text-gray-500">Score:</span><span className="ml-2 font-medium">{applicant.rubric_total}/100</span></div>
          <div><span className="text-gray-500">Pubs:</span><span className="ml-2 font-medium">{applicant.publications}</span></div>
        </div>
      </div>
    );
    const useIsMobile = () => {
      const [isMobile, setIsMobile] = useState(false);
      useEffect(() => {
        const mq = window.matchMedia('(max-width: 1023px)');
        const handler = (e) => setIsMobile(e.matches);
        setIsMobile(mq.matches);
        mq.addEventListener ? mq.addEventListener('change', handler) : mq.addListener(handler);
        return () => mq.removeEventListener ? mq.removeEventListener('change', handler) : mq.removeListener(handler);
      }, []);
      return isMobile;
    };
    const VSLOApp = () => {
      /* Settings */
      const [capacityPerMonth, setCapacityPerMonth] = useState(5);
      const [lockAccepted, setLockAccepted] = useState(false);
      /* State */
      const [activeTab, setActiveTab] = useState('upload');
      const [uploadedFiles, setUploadedFiles] = useState([]);
      const [processingStatus, setProcessingStatus] = useState('idle');
      const [processingProgress, setProcessingProgress] = useState(0);
      const [extractedData, setExtractedData] = useState([]);
      const [scoredData, setScoredData] = useState([]);
      const [selectedApplicant, setSelectedApplicant] = useState(null);
      const [logs, setLogs] = useState([]);
      const [sortConfig, setSortConfig] = useState({ key: 'rubric_total', direction: 'desc' });
      const [rotationAssignments, setRotationAssignments] = useState({});
      const [matchingStats, setMatchingStats] = useState(null);
      const [expandedCardId, setExpandedCardId] = useState(null);
      const [showMoveFor, setShowMoveFor] = useState(null);
      const [showAboutModal, setShowAboutModal] = useState(false);
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
      /* Bias Mitigation */
      const [biasChecks, setBiasChecks] = useState({
        missingStep2: false,
        normalizeScores: false,
        calculateBias: true
      });
      const [biasCalculating, setBiasCalculating] = useState(false);
      const [biasResults, setBiasResults] = useState(null);
      /* Re-run/Revert support */
      const prevAssignmentsRef = useRef(null);
      const prevStatsRef = useRef(null);
      const [canRevert, setCanRevert] = useState(false);
      /* Drag & drop support */
      const dragRef = useRef(null);
      const originalPositionsRef = useRef({});
      /* UI refs */
      const fileInputRef = useRef(null);
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      const isMobile = useIsMobile();
      const months = ['Aug 2025','Sep 2025','Oct 2025','Nov 2025','Dec 2025','Jan 2026','Feb 2026','Mar 2026','Apr 2026','May 2026','Jun 2026'];
      const [mobileMonthIdx, setMobileMonthIdx] = useState(0);
      const addLog = (message, type = 'info') => {
        const timestamp = new Date().toLocaleTimeString();
        setLogs(prev => [...prev, { timestamp, message, type }]);
      };
      const handleFileUpload = (event) => {
        const files = Array.from(event.target.files);
        const pdfFiles = files.filter(file => file.type === 'application/pdf');
        if (pdfFiles.length > 0) {
          setUploadedFiles(prev => [
            ...prev,
            ...pdfFiles.map(file => ({
              name: file.name,
              size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
              status: 'pending',
              id: Date.now() + Math.random()
            }))
          ]);
          addLog(`Uploaded ${pdfFiles.length} PDF file(s)`, 'success');
        }
        if (files.length > pdfFiles.length) {
          addLog(`${files.length - pdfFiles.length} non-PDF file(s) were ignored`, 'warning');
        }
      };
      const loadDemoData = () => {
        setProcessingStatus('processing');
        setProcessingProgress(0);
        setActiveTab('process');
        addLog('Starting demo processing...', 'info');
        let progress = 0;
        const interval = setInterval(() => {
          progress += Math.random() * 15;
          if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            setProcessingStatus('complete');
            addLog('Processing complete!', 'success');
            addLog('Loading demo data…', 'info');
            const simulatedData = [
              { applicant_id:'JD2026', name:'Jane Doe', email:'jane.m.doe@email.com', step1:245, step2:252, experiences:3, publications:1, honors:2, academics:22, letters:20, fit_interest:18, professionalism:23, rubric_total:83, recommendation:'Strong Accept', medical_school:'UC Davis', graduation_year:2026, rotation_preferences:['Oct 2025','Nov 2025','Sep 2025'], invitation_status:'accepted' },
              { applicant_id:'JS2025', name:'John Smith', email:'john.a.smith@example.com', step1:206, step2:208, experiences:2, publications:0, honors:0, academics:12, letters:10, fit_interest:13, professionalism:15, rubric_total:50, recommendation:'Hold', medical_school:'Midwest Community', graduation_year:2025, rotation_preferences:['Sep 2025','Oct 2025','Nov 2025'], invitation_status:'waitlist' },
              { applicant_id:'SR2026', name:'Sarah Rodriguez', email:'srodriguez@medschool.edu', step1:238, step2:241, experiences:4, publications:3, honors:3, academics:20, letters:22, fit_interest:21, professionalism:24, rubric_total:87, recommendation:'Strong Accept', medical_school:'Stanford', graduation_year:2026, rotation_preferences:['Nov 2025','Oct 2025','Jan 2026'], invitation_status:'accepted' },
              { applicant_id:'MK2026', name:'Michael Kim', email:'mkim@university.edu', step1:228, step2:null, experiences:5, publications:2, honors:1, academics:17, letters:18, fit_interest:20, professionalism:20, rubric_total:75, recommendation:'Accept', medical_school:'UCSF', graduation_year:2026, rotation_preferences:['Sep 2025','Aug 2025','Oct 2025'], invitation_status:'invited' },
              { applicant_id:'EW2027', name:'Emily Wang', email:'ewang@medical.edu', step1:195, step2:201, experiences:1, publications:0, honors:0, academics:8, letters:12, fit_interest:10, professionalism:18, rubric_total:48, recommendation:'Do Not Invite', medical_school:'State Medical College', graduation_year:2027, rotation_preferences:['Mar 2026','Apr 2026','May 2026'], invitation_status:'no response' },
              { applicant_id:'AC2026', name:'Alexandra Chen', email:'achen@northwestern.edu', step1:255, step2:262, experiences:6, publications:4, honors:4, academics:24, letters:23, fit_interest:22, professionalism:25, rubric_total:94, recommendation:'Strong Accept', medical_school:'Northwestern', graduation_year:2026, rotation_preferences:['Oct 2025','Sep 2025','Nov 2025'], invitation_status:'accepted' },
              { applicant_id:'DM2025', name:'David Martinez', email:'dmartinez@columbia.edu', step1:234, step2:239, experiences:3, publications:2, honors:2, academics:19, letters:17, fit_interest:19, professionalism:21, rubric_total:76, recommendation:'Accept', medical_school:'Columbia', graduation_year:2025, rotation_preferences:['Nov 2025','Dec 2025','Oct 2025'], invitation_status:'accepted' },
              { applicant_id:'LT2026', name:'Lisa Thompson', email:'lthompson@duke.edu', step1:248, step2:255, experiences:5, publications:5, honors:3, academics:23, letters:24, fit_interest:23, professionalism:24, rubric_total:94, recommendation:'Strong Accept', medical_school:'Duke', graduation_year:2026, rotation_preferences:['Sep 2025','Oct 2025','Aug 2025'], invitation_status:'accepted' },
              { applicant_id:'RJ2027', name:'Robert Johnson', email:'rjohnson@local.edu', step1:198, step2:204, experiences:1, publications:0, honors:1, academics:10, letters:11, fit_interest:12, professionalism:16, rubric_total:49, recommendation:'Hold', medical_school:'Local State University', graduation_year:2027, rotation_preferences:['Jan 2026','Feb 2026','Mar 2026'], invitation_status:'waitlist' },
              { applicant_id:'MP2026', name:'Maria Patel', email:'mpatel@yale.edu', step1:251, step2:258, experiences:7, publications:6, honors:5, academics:25, letters:25, fit_interest:24, professionalism:23, rubric_total:97, recommendation:'Strong Accept', medical_school:'Yale', graduation_year:2026, rotation_preferences:['Oct 2025','Nov 2025','Dec 2025'], invitation_status:'accepted' },
              { applicant_id:'TW2026', name:'Thomas Wilson', email:'twilson@michigan.edu', step1:226, step2:232, experiences:3, publications:1, honors:2, academics:16, letters:15, fit_interest:17, professionalism:19, rubric_total:67, recommendation:'Accept', medical_school:'University of Michigan', graduation_year:2026, rotation_preferences:['Dec 2025','Jan 2026','Feb 2026'], invitation_status:'invited' },
              { applicant_id:'NH2025', name:'Nina Harris', email:'nharris@wustl.edu', step1:244, step2:250, experiences:4, publications:3, honors:3, academics:21, letters:20, fit_interest:21, professionalism:22, rubric_total:84, recommendation:'Strong Accept', medical_school:'Washington University', graduation_year:2025, rotation_preferences:['Sep 2025','Nov 2025','Oct 2025'], invitation_status:'accepted' },
              { applicant_id:'KL2026', name:'Kevin Lee', email:'klee@upenn.edu', step1:236, step2:243, experiences:4, publications:2, honors:2, academics:18, letters:19, fit_interest:18, professionalism:20, rubric_total:75, recommendation:'Accept', medical_school:'University of Pennsylvania', graduation_year:2026, rotation_preferences:['Aug 2025','Sep 2025','Oct 2025'], invitation_status:'invited' },
              { applicant_id:'AG2027', name:'Amanda Garcia', email:'agarcia@community.edu', step1:202, step2:209, experiences:2, publications:0, honors:1, academics:11, letters:13, fit_interest:14, professionalism:17, rubric_total:55, recommendation:'Hold', medical_school:'Community Medical School', graduation_year:2027, rotation_preferences:['Feb 2026','Mar 2026','Apr 2026'], invitation_status:'waitlist' },
              { applicant_id:'CB2026', name:'Christopher Brown', email:'cbrown@harvard.edu', step1:257, step2:264, experiences:8, publications:7, honors:6, academics:25, letters:24, fit_interest:25, professionalism:25, rubric_total:99, recommendation:'Strong Accept', medical_school:'Harvard', graduation_year:2026, rotation_preferences:['Oct 2025','Sep 2025','Nov 2025'], invitation_status:'accepted' },
            ];
            setExtractedData(simulatedData);
            setScoredData(simulatedData);
            runMatchingAlgorithm(simulatedData);
            setActiveTab('results');
          }
          setProcessingProgress(progress);
          if (progress < 30) addLog('Extracting text from PDFs...', 'info');
          else if (progress < 60) addLog('Running LLM extraction with Mistral...', 'info');
          else if (progress < 90) addLog('Scoring applicants using rubric...', 'info');
        }, 500);
      };
      const cloneAssignments = (assign) =>
        Object.fromEntries(Object.entries(assign).map(([m, arr]) => [m, [...arr]]));
      const ensureBaselinePositions = (assignments) => {
        months.forEach(month => {
          const arr = assignments[month] || [];
          arr.forEach((stu, idx) => {
            if (stu && stu.applicant_id && !originalPositionsRef.current[stu.applicant_id]) {
              originalPositionsRef.current[stu.applicant_id] = { month, index: idx };
            }
          });
        });
      };
      const recomputeStatsFromAssignments = (assignments, allApplicants) => {
        let first = 0, second = 0, third = 0;
        let placedIds = new Set();
        months.forEach(m => {
          (assignments[m] || []).forEach(a => {
            if (!a) return;
            placedIds.add(a.applicant_id);
            const prefs = a.rotation_preferences || [];
            const idx = prefs.indexOf(m);
            if (idx === 0) first++;
            else if (idx === 1) second++;
            else if (idx === 2) third++;
          });
        });
        const total = (allApplicants || []).length;
        const unmatched = Math.max(total - placedIds.size, 0);
        return { firstChoice: first, secondChoice: second, thirdChoice: third, unmatched };
      };
      const runMatchingAlgorithm = (applicants) => {
        if (!Array.isArray(applicants) || applicants.length === 0) {
          addLog('Matching aborted: applicants array is empty.', 'warning');
          setRotationAssignments({});
          setMatchingStats(null);
          return;
        }
        const assignments = {};
        months.forEach(m => (assignments[m] = []));
        const tryPlace = (student, month) => {
          if (!assignments[month]) return false;
          if (assignments[month].length >= capacityPerMonth) return false;
          assignments[month].push({ ...student, assigned_month: month });
          return true;
        };
        const lockedIds = new Set();
        if (lockAccepted) {
          months.forEach(month => {
            (rotationAssignments[month] || []).forEach(stu => {
              if (stu?.invitation_status === 'accepted') {
                const placed = tryPlace(
                  { ...stu, preference_matched: stu.preference_matched ?? null },
                  month
                );
                if (placed) lockedIds.add(stu.applicant_id);
              }
            });
          });
        }
        const remaining = applicants.filter(a => !lockedIds.has(a.applicant_id));
        remaining.sort((a, b) => (b.rubric_total ?? 0) - (a.rubric_total ?? 0));
        remaining.forEach(applicant => {
          const prefs = Array.isArray(applicant.rotation_preferences) ? applicant.rotation_preferences : [];
          let assigned = false;
          for (let i = 0; i < prefs.length; i++) {
            if (tryPlace(applicant, prefs[i])) { assigned = true; break; }
          }
        });
        ensureBaselinePositions(assignments);
        setRotationAssignments(assignments);
        setMatchingStats(recomputeStatsFromAssignments(assignments, applicants));
        const totalPlaced = months.reduce((s, m) => s + (assignments[m]?.length || 0), 0);
        addLog(`Matching complete: placed ${totalPlaced} / ${applicants.length}.`, 'success');
      };
      const simulateProcessing = () => {
        setProcessingStatus('processing');
        setProcessingProgress(0);
        setActiveTab('process');
        addLog('Starting PDF text extraction...', 'info');
        let progress = 0;
        const interval = setInterval(() => {
          progress += Math.random() * 15;
          if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            setProcessingStatus('complete');
            addLog('Processing complete!', 'success');
            const simulatedData = [
              { applicant_id:'JD2026', name:'Jane Doe', email:'jane.m.doe@email.com', step1:245, step2:252, experiences:3, publications:1, honors:2, academics:22, letters:20, fit_interest:18, professionalism:23, rubric_total:83, recommendation:'Strong Accept', medical_school:'UC Davis', graduation_year:2026, rotation_preferences:['Oct 2025','Nov 2025','Sep 2025'], invitation_status:'accepted' },
              { applicant_id:'JS2025', name:'John Smith', email:'john.a.smith@example.com', step1:206, step2:208, experiences:2, publications:0, honors:0, academics:12, letters:10, fit_interest:13, professionalism:15, rubric_total:50, recommendation:'Hold', medical_school:'Midwest Community', graduation_year:2025, rotation_preferences:['Sep 2025','Oct 2025','Nov 2025'], invitation_status:'waitlist' },
              { applicant_id:'SR2026', name:'Sarah Rodriguez', email:'srodriguez@medschool.edu', step1:238, step2:241, experiences:4, publications:3, honors:3, academics:20, letters:22, fit_interest:21, professionalism:24, rubric_total:87, recommendation:'Strong Accept', medical_school:'Stanford', graduation_year:2026, rotation_preferences:['Nov 2025','Oct 2025','Jan 2026'], invitation_status:'accepted' },
              { applicant_id:'MK2026', name:'Michael Kim', email:'mkim@university.edu', step1:228, step2:null, experiences:5, publications:2, honors:1, academics:17, letters:18, fit_interest:20, professionalism:20, rubric_total:75, recommendation:'Accept', medical_school:'UCSF', graduation_year:2026, rotation_preferences:['Sep 2025','Aug 2025','Oct 2025'], invitation_status:'invited' },
              { applicant_id:'EW2027', name:'Emily Wang', email:'ewang@medical.edu', step1:195, step2:201, experiences:1, publications:0, honors:0, academics:8, letters:12, fit_interest:10, professionalism:18, rubric_total:48, recommendation:'Do Not Invite', medical_school:'State Medical College', graduation_year:2027, rotation_preferences:['Mar 2026','Apr 2026','May 2026'], invitation_status:'no response' },
              { applicant_id:'AC2026', name:'Alexandra Chen', email:'achen@northwestern.edu', step1:255, step2:262, experiences:6, publications:4, honors:4, academics:24, letters:23, fit_interest:22, professionalism:25, rubric_total:94, recommendation:'Strong Accept', medical_school:'Northwestern', graduation_year:2026, rotation_preferences:['Oct 2025','Sep 2025','Nov 2025'], invitation_status:'accepted' },
              { applicant_id:'DM2025', name:'David Martinez', email:'dmartinez@columbia.edu', step1:234, step2:239, experiences:3, publications:2, honors:2, academics:19, letters:17, fit_interest:19, professionalism:21, rubric_total:76, recommendation:'Accept', medical_school:'Columbia', graduation_year:2025, rotation_preferences:['Nov 2025','Dec 2025','Oct 2025'], invitation_status:'accepted' },
              { applicant_id:'LT2026', name:'Lisa Thompson', email:'lthompson@duke.edu', step1:248, step2:255, experiences:5, publications:5, honors:3, academics:23, letters:24, fit_interest:23, professionalism:24, rubric_total:94, recommendation:'Strong Accept', medical_school:'Duke', graduation_year:2026, rotation_preferences:['Sep 2025','Oct 2025','Aug 2025'], invitation_status:'accepted' },
              { applicant_id:'RJ2027', name:'Robert Johnson', email:'rjohnson@local.edu', step1:198, step2:204, experiences:1, publications:0, honors:1, academics:10, letters:11, fit_interest:12, professionalism:16, rubric_total:49, recommendation:'Hold', medical_school:'Local State University', graduation_year:2027, rotation_preferences:['Jan 2026','Feb 2026','Mar 2026'], invitation_status:'waitlist' },
              { applicant_id:'MP2026', name:'Maria Patel', email:'mpatel@yale.edu', step1:251, step2:258, experiences:7, publications:6, honors:5, academics:25, letters:25, fit_interest:24, professionalism:23, rubric_total:97, recommendation:'Strong Accept', medical_school:'Yale', graduation_year:2026, rotation_preferences:['Oct 2025','Nov 2025','Dec 2025'], invitation_status:'accepted' },
              { applicant_id:'TW2026', name:'Thomas Wilson', email:'twilson@michigan.edu', step1:226, step2:232, experiences:3, publications:1, honors:2, academics:16, letters:15, fit_interest:17, professionalism:19, rubric_total:67, recommendation:'Accept', medical_school:'University of Michigan', graduation_year:2026, rotation_preferences:['Dec 2025','Jan 2026','Feb 2026'], invitation_status:'invited' },
              { applicant_id:'NH2025', name:'Nina Harris', email:'nharris@wustl.edu', step1:244, step2:250, experiences:4, publications:3, honors:3, academics:21, letters:20, fit_interest:21, professionalism:22, rubric_total:84, recommendation:'Strong Accept', medical_school:'Washington University', graduation_year:2025, rotation_preferences:['Sep 2025','Nov 2025','Oct 2025'], invitation_status:'accepted' },
              { applicant_id:'KL2026', name:'Kevin Lee', email:'klee@upenn.edu', step1:236, step2:243, experiences:4, publications:2, honors:2, academics:18, letters:19, fit_interest:18, professionalism:20, rubric_total:75, recommendation:'Accept', medical_school:'University of Pennsylvania', graduation_year:2026, rotation_preferences:['Aug 2025','Sep 2025','Oct 2025'], invitation_status:'invited' },
              { applicant_id:'AG2027', name:'Amanda Garcia', email:'agarcia@community.edu', step1:202, step2:209, experiences:2, publications:0, honors:1, academics:11, letters:13, fit_interest:14, professionalism:17, rubric_total:55, recommendation:'Hold', medical_school:'Community Medical School', graduation_year:2027, rotation_preferences:['Feb 2026','Mar 2026','Apr 2026'], invitation_status:'waitlist' },
              { applicant_id:'CB2026', name:'Christopher Brown', email:'cbrown@harvard.edu', step1:257, step2:264, experiences:8, publications:7, honors:6, academics:25, letters:24, fit_interest:25, professionalism:25, rubric_total:99, recommendation:'Strong Accept', medical_school:'Harvard', graduation_year:2026, rotation_preferences:['Oct 2025','Sep 2025','Nov 2025'], invitation_status:'accepted' },
            ];
            setExtractedData(simulatedData);
            setScoredData(simulatedData);
            runMatchingAlgorithm(simulatedData);
            setActiveTab('results');
          }
          setProcessingProgress(progress);
          if (progress < 30) addLog('Extracting text from PDFs...', 'info');
          else if (progress < 60) addLog('Running LLM extraction with Mistral...', 'info');
          else if (progress < 90) addLog('Scoring applicants using rubric...', 'info');
        }, 500);
      };
      const handleSort = (key) => {
        let direction = 'asc';
        if (sortConfig.key === key && sortConfig.direction === 'asc') direction = 'desc';
        setSortConfig({ key, direction });
        const sorted = [...scoredData].sort((a,b) => {
          const aVal = a[key] ?? 0;
          const bVal = b[key] ?? 0;
          if (typeof aVal === 'string') {
            return direction === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
          }
          return direction === 'asc' ? aVal - bVal : bVal - aVal;
        });
        setScoredData(sorted);
      };
      const SortArrow = ({ column }) => {
        if (sortConfig.key !== column) return <span className="text-gray-500">↕</span>;
        return sortConfig.direction === 'asc'
          ? <span className="text-gray-700">↑</span>
          : <span className="text-gray-700">↓</span>;
      };
      useEffect(() => {
        if (isMobile) return;
        if (scoredData.length > 0 && activeTab === 'results' && chartRef.current) {
          if (chartInstance.current) chartInstance.current.destroy();
          const ctx = chartRef.current.getContext('2d');
          chartInstance.current = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: scoredData.map(d => d.name.split(' ')[1]),
              datasets: [
                { label: 'Step 1', data: scoredData.map(d => d.step1 || 0) },
                { label: 'Step 2', data: scoredData.map(d => d.step2 || 0) },
                { label: 'Total Score', data: scoredData.map(d => d.rubric_total), yAxisID: 'y1' }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: { beginAtZero: true, max: 300, title: { display: true, text: 'USMLE Scores' } },
                y1: { beginAtZero: true, max: 100, position: 'right', title: { display: true, text: 'Total Score' }, grid: { drawOnChartArea: false } }
              },
              plugins: {
                legend: { position: 'top' },
                tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label || ''}: ${ctx.parsed.y}` } }
              }
            }
          });
          return () => {
            if (chartInstance.current) chartInstance.current.destroy();
          };
        }
      }, [scoredData, activeTab, isMobile]);
      const exportRotationSchedule = () => {
        console.log('Exporting rotation schedule...', rotationAssignments);
        addLog('Export triggered (replace with real export logic).', 'info');
      };
      const exportExcelWorkbook = () => {
        const workbook = {
          'Master_List': scoredData.map((a, idx) => ({
            'Rank': idx + 1,
            'Name': a.name,
            'Email': a.email,
            'Medical School': a.medical_school,
            'Graduation Year': a.graduation_year,
            'Step 1': a.step1 || 'N/A',
            'Step 2': a.step2 || 'N/A',
            'Experiences': a.experiences,
            'Publications': a.publications,
            'Honors': a.honors,
            'Academics Score': a.academics,
            'Letters Score': a.letters,
            'Fit & Interest Score': a.fit_interest,
            'Professionalism Score': a.professionalism,
            'Total Score': a.rubric_total,
            'Recommendation': a.recommendation,
            'Rotation Preferences': (a.rotation_preferences || []).join(', '),
            'Invitation Status': a.invitation_status
          })),
          'Ranked_View': [...scoredData].sort((a, b) => b.rubric_total - a.rubric_total).map((a, idx) => ({
            'Rank': idx + 1,
            'Name': a.name,
            'Total Score': a.rubric_total,
            'Recommendation': a.recommendation,
            'Medical School': a.medical_school,
            'Step 1': a.step1 || 'N/A',
            'Step 2': a.step2 || 'N/A'
          })),
          'Red_Flags': scoredData.filter(a =>
            a.recommendation === 'Do Not Invite' ||
            a.recommendation === 'Hold' ||
            a.step1 < 210 ||
            a.rubric_total < 60
          ).map(a => ({
            'Name': a.name,
            'Issue': a.recommendation === 'Do Not Invite' ? 'Not Recommended' :
                     a.recommendation === 'Hold' ? 'On Hold' :
                     a.step1 < 210 ? 'Low Step 1 Score' :
                     'Low Total Score',
            'Total Score': a.rubric_total,
            'Step 1': a.step1 || 'N/A',
            'Step 2': a.step2 || 'N/A'
          })),
          'Audit': [{
            'Process Date': new Date().toISOString(),
            'Total Applications': scoredData.length,
            'Strong Accept': scoredData.filter(a => a.recommendation === 'Strong Accept').length,
            'Accept': scoredData.filter(a => a.recommendation === 'Accept').length,
            'Hold': scoredData.filter(a => a.recommendation === 'Hold').length,
            'Do Not Invite': scoredData.filter(a => a.recommendation === 'Do Not Invite').length,
            'Average Score': (scoredData.reduce((s,a)=>s+a.rubric_total,0)/scoredData.length).toFixed(2)
          }]
        };
        const csvContent = Object.entries(workbook).map(([sheetName, data]) => {
          if (data.length === 0) return '';
          const headers = Object.keys(data[0]);
          const csv = [
            headers.join(','),
            ...data.map(row => headers.map(h => JSON.stringify(row[h] || '')).join(','))
          ].join('\n');
          return `Sheet: ${sheetName}\n${csv}\n\n`;
        }).join('');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `VSLO_Applications_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        addLog('Excel workbook exported successfully', 'success');
      };
      const exportJSON = () => {
        const exportData = {
          metadata: {
            exportDate: new Date().toISOString(),
            totalApplications: scoredData.length,
            processingDate: new Date().toISOString()
          },
          extracted: extractedData,
          scored: scoredData,
          rotationAssignments: rotationAssignments,
          matchingStatistics: matchingStats
        };
        const jsonlContent = scoredData.map(record => JSON.stringify(record)).join('\n');
        const jsonBlob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
        const jsonUrl = URL.createObjectURL(jsonBlob);
        const jsonLink = document.createElement('a');
        jsonLink.href = jsonUrl;
        jsonLink.download = `VSLO_Full_Export_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(jsonLink);
        jsonLink.click();
        document.body.removeChild(jsonLink);
        URL.revokeObjectURL(jsonUrl);
        const jsonlBlob = new Blob([jsonlContent], { type: 'application/x-ndjson' });
        const jsonlUrl = URL.createObjectURL(jsonlBlob);
        const jsonlLink = document.createElement('a');
        jsonlLink.href = jsonlUrl;
        jsonlLink.download = `VSLO_Scored_${new Date().toISOString().split('T')[0]}.jsonl`;
        document.body.appendChild(jsonlLink);
        jsonlLink.click();
        document.body.removeChild(jsonlLink);
        URL.revokeObjectURL(jsonlUrl);
        addLog('JSON exports completed successfully', 'success');
      };
      const runBiasVerification = () => {
        setBiasCalculating(true);
        setBiasResults(null);
        setTimeout(() => {
          const results = {};
          if (biasChecks.missingStep2) {
            results.missingStep2 = {
              status: 'complete',
              message: 'Applicants with missing Step 2 scores have been neutrally weighted. No significant ranking changes detected.',
              impact: 'Low'
            };
          }
          if (biasChecks.normalizeScores) {
            results.normalizeScores = {
              status: 'complete',
              message: 'Letter and academic scores normalized across reviewers. Minor adjustments made to 3 applicants.',
              impact: 'Medium'
            };
          }
          if (biasChecks.calculateBias) {
            results.calculateBias = {
              status: 'complete',
              message: 'Bias probability analysis complete. Score distribution appears balanced with no systematic bias detected.',
              impact: 'Pass'
            };
          }
          results.summary = {
            overallStatus: 'Verification Complete',
            recommendation: 'Rankings appear fair and consistent. Proceed with holistic review focusing on top 10 candidates. Consider manual review for borderline cases (65–75).',
            nextSteps: [
              'Review top 10 candidates in detail',
              'Examine borderline applicants individually',
              'Confirm rotation preferences match capacity'
            ]
          };
          setBiasResults(results);
          setBiasCalculating(false);
          addLog('Bias verification completed successfully', 'success');
        }, 1200);
      };
      const getOriginalPosition = (applicant_id) => originalPositionsRef.current[applicant_id] || null;
      const findApplicantPosition = (assignments, applicant_id) => {
        for (const month of months) {
          const arr = assignments[month] || [];
          const idx = arr.findIndex(x => x?.applicant_id === applicant_id);
          if (idx !== -1) return { month, index: idx };
        }
        return null;
      };
      const isMoved = (applicant, currentMonth, currentIndex) => {
        const orig = applicant?.applicant_id ? getOriginalPosition(applicant.applicant_id) : null;
        if (!orig) return false;
        return orig.month !== currentMonth || orig.index !== currentIndex;
      };
      /* Updated Drag Handlers */
      const handleDragStart = (student, fromMonth, fromIndex, e) => {
        if (lockAccepted && student.invitation_status === 'accepted') {
          addLog(`Cannot drag ${student.name}: Slot is locked (accepted student).`, 'warning');
          e.preventDefault();
          return;
        }
        dragRef.current = { applicant_id: student.applicant_id, fromMonth, fromIndex };
        e.dataTransfer.setData('text/plain', student.applicant_id);
        e.dataTransfer.effectAllowed = 'move';
        // Simplify drag image to use default browser behavior for better compatibility
        e.target.classList.add('dragging');
        addLog(`Dragging ${student.name} from ${fromMonth} slot ${fromIndex + 1}`, 'info');
      };
      const handleDragOver = (toMonth, toIndex, student, e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        // Add visual feedback for valid/invalid drop zones
        const target = e.currentTarget;
        if (lockAccepted && student?.invitation_status === 'accepted') {
          target.classList.add('drag-over-invalid');
        } else if (!student || (toMonth !== dragRef.current?.fromMonth || toIndex !== dragRef.current?.fromIndex)) {
          target.classList.add('drag-over-valid');
        } else {
          target.classList.add('drag-over-invalid');
        }
      };
      const handleDragLeave = (e) => {
        e.currentTarget.classList.remove('drag-over-valid', 'drag-over-invalid');
      };
      const handleDrop = (toMonth, toIndex, student, e) => {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over-valid', 'drag-over-invalid');
        const drag = dragRef.current;
        if (!drag) return;
        const { applicant_id, fromMonth, fromIndex } = drag;
        if (fromMonth === toMonth && fromIndex === toIndex) {
          addLog(`No move: ${student?.name || 'Applicant'} dropped in same slot.`, 'info');
          return;
        }
        if (lockAccepted && student?.invitation_status === 'accepted') {
          addLog(`Cannot drop: Target slot in ${toMonth} is locked (accepted student).`, 'warning');
          return;
        }
        setRotationAssignments(prev => {
          const next = cloneAssignments(prev);
          const fromArr = next[fromMonth] || [];
          const toArr = next[toMonth] || [];
          const dragged = fromArr[fromIndex];
          if (!dragged || dragged.applicant_id !== applicant_id) {
            addLog(`Invalid drop: Dragged applicant not found.`, 'error');
            return prev;
          }
          const target = toArr[toIndex];
          toArr[toIndex] = { ...dragged, assigned_month: toMonth };
          if (target) {
            fromArr[fromIndex] = { ...target, assigned_month: fromMonth };
          } else {
            fromArr[fromIndex] = undefined;
          }
          next[fromMonth] = fromArr.filter(x => x !== undefined);
          next[toMonth] = toArr;
          const stats = recomputeStatsFromAssignments(next, scoredData);
          setMatchingStats(stats);
          addLog(
            `Dropped ${dragged.name} into ${toMonth} slot ${toIndex + 1}${target ? ' (swapped)' : ''}.`,
            'success'
          );
          return next;
        });
        dragRef.current = null;
        document.querySelectorAll('.dragging').forEach(el => el.classList.remove('dragging'));
      };
      const handleDragEnd = () => {
        dragRef.current = null;
        document.querySelectorAll('.drag-over-valid, .drag-over-invalid, .dragging')
          .forEach(el => el.classList.remove('drag-over-valid', 'drag-over-invalid', 'dragging'));
        addLog('Drag operation ended.', 'info');
      };
      const handleRevertToOriginal = (applicant_id) => {
        const orig = getOriginalPosition(applicant_id);
        if (!orig) {
          addLog('No original position recorded for this applicant.', 'warning');
          return;
        }
        setRotationAssignments(prev => {
          const next = cloneAssignments(prev);
          const current = findApplicantPosition(next, applicant_id);
          if (!current) return prev;
          const curArr = next[current.month] || [];
          const origArr = next[orig.month] || [];
          const moving = curArr[current.index];
          const displaced = origArr[orig.index];
          origArr[orig.index] = moving;
          curArr[current.index] = displaced || undefined;
          next[current.month] = curArr;
          next[orig.month] = origArr;
          const stats = recomputeStatsFromAssignments(next, scoredData);
          setMatchingStats(stats);
          addLog(
            `Reverted ${moving?.name || applicant_id} to original ${orig.month} slot ${orig.index + 1}.`,
            'warning'
          );
          return next;
        });
      };
      const performMove = (applicant, fromMonth, fromIndex, toMonth, toIndex) => {
        setRotationAssignments(prev => {
          const next = cloneAssignments(prev);
          const fromArr = next[fromMonth] || [];
          const toArr = next[toMonth] || [];
          const dragged = fromArr[fromIndex];
          if (!dragged || dragged.applicant_id !== applicant.applicant_id) return prev;
          const target = toArr[toIndex];
          toArr[toIndex] = dragged;
          fromArr[fromIndex] = target || undefined;
          next[fromMonth] = fromArr;
          next[toMonth] = toArr;
          const stats = recomputeStatsFromAssignments(next, scoredData);
          setMatchingStats(stats);
          addLog(`Moved ${dragged.name} to ${toMonth} slot ${toIndex+1} via action.`, 'success');
          return next;
        });
        setShowMoveFor(null);
      };
      const handleRevertSchedule = () => {
        if (prevAssignmentsRef.current && prevStatsRef.current) {
          setRotationAssignments(prevAssignmentsRef.current);
          setMatchingStats(prevStatsRef.current);
          addLog('Reverted to prior rotation assignment state.', 'warning');
          prevAssignmentsRef.current = null;
          prevStatsRef.current = null;
          setCanRevert(false);
        } else {
          addLog('No prior state to revert to.', 'warning');
        }
      };
      return (
        <div className="min-h-screen flex flex-col">
          <div className="gradient-bg text-white sticky top-0 z-30">
            <div className="container mx-auto px-4 sm:px-6 py-6">
              <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-2">
                <div className="flex items-center justify-between">
                  <div>
                    <h1 className="text-2xl sm:text-3xl font-bold mb-1">VSLO Application Processing</h1>
                    <p className="text-purple-100 text-sm sm:text-base">Automated ERAS PDF extraction and scoring system</p>
                  </div>
                  <button className="lg:hidden ml-4 p-2 rounded-lg bg-white/20 hover:bg-white/30"
                    onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                  >
                    <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                      {mobileMenuOpen ? (
                        <path d="M6 18L18 6M6 6l12 12" />
                      ) : (
                        <>
                          <line x1="3" y1="6" x2="21" y2="6"></line>
                          <line x1="3" y1="12" x2="21" y2="12"></line>
                          <line x1="3" y1="18" x2="21" y2="18"></line>
                        </>
                      )}
                    </svg>
                  </button>
                </div>
                <div className="text-right hidden lg:block">
                  <div className="text-xs sm:text-sm text-purple-100">Anesthesiology VSLO</div>
                  <a
                    href="https://health.ucdavis.edu/anesthesiology/education/clerkship/"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-xl sm:text-2xl font-bold hover:text-purple-200 transition-colors"
                  >
                    ANES460
                  </a>
                </div>
              </div>
              <div className="hidden lg:flex lg:flex-row lg:flex-wrap gap-3">
                <TabButton icon={<FileUploadIcon />} label="Upload" tabKey="upload" activeTab={activeTab} setActiveTab={setActiveTab}/>
                <TabButton icon={<ProcessIcon />} label="Process" tabKey="process" activeTab={activeTab} setActiveTab={setActiveTab}/>
                <TabButton icon={<ChartIcon />} label="Results" tabKey="results" activeTab={activeTab} setActiveTab={setActiveTab}/>
                <TabButton icon={<TableIcon />} label="Rankings" tabKey="table" activeTab={activeTab} setActiveTab={setActiveTab}/>
                <TabButton icon={<CalendarIcon />} label="Scheduling" tabKey="rotations" activeTab={activeTab} setActiveTab={setActiveTab}/>
                <TabButton icon={<ShieldIcon />} label="Bias Mitigation" tabKey="bias" activeTab={activeTab} setActiveTab={setActiveTab}/>
                <TabButton icon={<DownloadIcon />} label="Export" tabKey="export" activeTab={activeTab} setActiveTab={setActiveTab}/>
              </div>
              {mobileMenuOpen && (
                <>
                  <div
                    className="fixed inset-0 bg-black/30 sm:hidden"
                    onClick={() => setMobileMenuOpen(false)}
                  ></div>
                  <div className="absolute top-full left-0 right-0 bg-purple-700 shadow-lg sm:hidden animate-slide-in z-40">
                    <div className="container mx-auto px-4 py-4 space-y-2">
                      <button
                        onClick={() => {
                          setActiveTab('upload');
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'upload' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <FileUploadIcon />
                        <span className="font-medium">Upload</span>
                      </button>
                      <button
                        onClick={() => {
                          setActiveTab('process');
                          setMobileMenuOpen(false);
                          if (uploadedFiles.length > 0) {
                            simulateProcessing();
                          } else {
                            loadDemoData();
                          }
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'process' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <ProcessIcon />
                        <span className="font-medium">Process</span>
                      </button>
                      <button
                        onClick={() => {
                          setActiveTab('results');
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'results' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <ChartIcon />
                        <span className="font-medium">Results</span>
                      </button>
                      <button
                        onClick={() => {
                          setActiveTab('table');
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'table' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <TableIcon />
                        <span className="font-medium">Rankings</span>
                      </button>
                      <button
                        onClick={() => {
                          setActiveTab('rotations');
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'rotations' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <CalendarIcon />
                        <span className="font-medium">Scheduling</span>
                      </button>
                      <button
                        onClick={() => {
                          setActiveTab('bias');
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'bias' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <ShieldIcon />
                        <span className="font-medium">Bias Mitigation</span>
                      </button>
                      <button
                        onClick={() => {
                          setActiveTab('export');
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all
                          ${activeTab === 'export' ? 'bg-white text-purple-600' : 'bg-white/10 text-white hover:bg-white/20'}`}
                      >
                        <DownloadIcon />
                        <span className="font-medium">Export</span>
                      </button>
                      <button
                        onClick={() => {
                          setShowAboutModal(true);
                          setMobileMenuOpen(false);
                        }}
                        className="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all bg-white/10 text-white hover:bg-white/20"
                      >
                        <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                          <path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span className="font-medium">About</span>
                      </button>
                      <a
                        href="https://health.ucdavis.edu/anesthesiology/education/clerkship/"
                        target="_blank"
                        rel="noopener noreferrer"
                        onClick={() => setMobileMenuOpen(false)}
                        className="w-full flex items-center justify-between px-4 py-3 rounded-lg bg-purple-800 text-white"
                      >
                        <div>
                          <div className="text-xs text-purple-200">Anesthesiology VSLO v1.6</div>
                          <div className="text-lg font-bold">ANES460</div>
                        </div>
                        <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                          <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                      </a>
                    </div>
                  </div>
                </>
              )}
            </div>
          </div>
          <div className="container mx-auto px-4 sm:px-6 py-8 flex-1">
            {activeTab === 'upload' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-6 sm:p-8 mb-6">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-6 text-gray-800">Upload ERAS PDFs</h2>
                  <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 sm:p-12 text-center hover:border-purple-400 transition-colors">
                    <input
                      ref={fileInputRef}
                      type="file"
                      multiple
                      accept=".pdf"
                      onChange={handleFileUpload}
                      className="hidden"
                    />
                    <div className="flex justify-center">
                      <FileUploadIcon />
                    </div>
                    <p className="mt-4 text-base sm:text-lg text-gray-600">
                      Drag and drop PDF files here, or{' '}
                      <button
                        onClick={() => fileInputRef.current && fileInputRef.current.click()}
                        className="text-purple-600 hover:text-purple-700 font-medium underline"
                      >
                        browse
                      </button>
                    </p>
                    <p className="mt-2 text-sm text-gray-500">Only PDF files are accepted</p>
                    <div className="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3">
                      <button
                        onClick={loadDemoData}
                        className="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors"
                      >
                        Start Demo (Bypass Upload)
                      </button>
                      <button
                        onClick={simulateProcessing}
                        disabled={uploadedFiles.length === 0}
                        className={`w-full px-6 py-3 rounded-lg font-medium transition-colors
                          ${uploadedFiles.length > 0
                            ? 'bg-purple-600 text-white hover:bg-purple-700'
                            : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                      >
                        Process Uploaded PDFs
                      </button>
                    </div>
                  </div>
                  {uploadedFiles.length > 0 && (
                    <div className="mt-8">
                      <h3 className="font-semibold mb-4 text-gray-700">Uploaded Files ({uploadedFiles.length})</h3>
                      <div className="space-y-2">
                        {uploadedFiles.map(file => (
                          <div key={file.id} className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                            <div className="flex items-center space-x-3 truncate">
                              <FileUploadIcon />
                              <div className="min-w-0">
                                <p className="font-medium text-gray-800 truncate">{file.name}</p>
                                <p className="text-sm text-gray-500">{file.size}</p>
                              </div>
                            </div>
                            <div className="flex items-center space-x-3">
                              <span className="text-green-600 whitespace-nowrap">✓ Ready</span>
                              <button
                                onClick={() => {
                                  setUploadedFiles(prev => prev.filter(f => f.id !== file.id));
                                  addLog(`Removed ${file.name} from upload list`, 'info');
                                }}
                                className="text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full p-1 transition-colors"
                                title="Remove file"
                              >
                                <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                                  <line x1="18" y1="6" x2="6" y2="18"></line>
                                  <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
            {activeTab === 'process' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-6 sm:p-8 mb-6">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-6 text-gray-800">Processing Pipeline</h2>
                  <div className="space-y-4">
                    <div className="bg-gray-200 rounded-full h-3 sm:h-4 overflow-hidden">
                      <div
                        className="h-full bg-gradient-to-r from-purple-500 to-purple-600 transition-all duration-500"
                        style={{ width: `${processingProgress}%` }}
                      />
                    </div>
                    <p className="text-center text-gray-600 text-sm sm:text-base">
                      {processingStatus === 'idle' && 'Ready to process'}
                      {processingStatus === 'processing' && `Processing... ${Math.round(processingProgress)}%`}
                      {processingStatus === 'complete' && 'Processing complete!'}
                    </p>
                    <div className="mt-6 sm:mt-8 space-y-3 sm:space-y-4">
                      {[
                        { step: 1, name: 'PDF Text Extraction', desc: 'Extract text using pdfplumber/OCR' },
                        { step: 2, name: 'LLM Processing', desc: 'Extract structured data with Mistral' },
                        { step: 3, name: 'Schema Validation', desc: 'Validate against JSON schema' },
                        { step: 4, name: 'Scoring & Ranking', desc: 'Apply rubric and calculate scores' },
                        { step: 5, name: 'Bias Mitigation — Verify Rank', desc: 'Audit ranking for fairness and consistency' }
                      ].map(({ step, name, desc }) => (
                        <div key={step}
                          className={`flex items-start space-x-4 p-4 rounded-lg transition-all
                            ${processingProgress >= (step - 1) * 20 ? 'bg-purple-50 border border-purple-200' : 'bg-gray-50'}`}>
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0
                            ${processingProgress >= step * 20 ? 'bg-green-500' :
                               processingProgress >= (step - 1) * 20 ? 'bg-purple-500 animate-pulse-slow' : 'bg-gray-300'}`}>
                            {processingProgress >= step * 20 ? '✓' : step}
                          </div>
                          <div className="flex-1">
                            <h3 className="font-semibold text-gray-800">{name}</h3>
                            <p className="text-sm text-gray-600">{desc}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  <div className="mt-6 sm:mt-8">
                    <h3 className="font-semibold mb-3 sm:mb-4 text-gray-700">Processing Logs</h3>
                    <div className="bg-gray-900 text-green-400 p-3 sm:p-4 rounded-lg h-48 overflow-y-auto font-mono text-xs sm:text-sm">
                      {logs.map((log, idx) => (
                        <div key={idx} className="mb-1">
                          <span className="text-gray-500">[{log.timestamp}]</span>
                          <span className={`ml-2
                            ${log.type === 'error' ? 'text-red-400' :
                               log.type === 'warning' ? 'text-yellow-400' :
                               log.type === 'success' ? 'text-green-400' : 'text-gray-300'}`}>
                            {log.message}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}
            {activeTab === 'results' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-6 sm:p-8 mb-6">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-6 text-gray-800">Applicant Results</h2>
                  {scoredData.length > 0 ? (
                    <div>
                      <div className="grid grid-cols-2 sm:grid-cols-5 gap-3 sm:gap-4 mb-6 sm:mb-8">
                        <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg">
                          <p className="text-xs sm:text-sm text-blue-600 mb-1">Total</p>
                          <p className="text-xl sm:text-2xl font-bold text-blue-900">{scoredData.length}</p>
                        </div>
                        <div className="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg">
                          <p className="text-xs sm:text-sm text-green-600 mb-1">Strong Accept</p>
                          <p className="text-xl sm:text-2xl font-bold text-green-900">
                            {scoredData.filter(a => a.recommendation === 'Strong Accept').length}
                          </p>
                        </div>
                        <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg">
                          <p className="text-xs sm:text-sm text-blue-600 mb-1">Accept</p>
                          <p className="text-xl sm:text-2xl font-bold text-blue-900">
                            {scoredData.filter(a => a.recommendation === 'Accept').length}
                          </p>
                        </div>
                        <div className="bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 rounded-lg">
                          <p className="text-xs sm:text-sm text-yellow-600 mb-1">Hold</p>
                          <p className="text-xl sm:text-2xl font-bold text-yellow-900">
                            {scoredData.filter(a => a.recommendation === 'Hold').length}
                          </p>
                        </div>
                        <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg col-span-2 sm:col-span-1">
                          <p className="text-xs sm:text-sm text-purple-600 mb-1">Avg Score</p>
                          <p className="text-xl sm:text-2xl font-bold text-purple-900">
                            {(scoredData.reduce((s,a)=>s+a.rubric_total,0)/scoredData.length).toFixed(1)}
                          </p>
                        </div>
                      </div>
                      <div className="mb-8 bg-white p-4 sm:p-6 rounded-lg shadow-sm hidden md:block">
                        <h3 className="font-semibold mb-4 text-gray-700">Score Comparison</h3>
                        <div style={{ height: '300px' }}>
                          <canvas ref={chartRef}></canvas>
                        </div>
                      </div>
                      <h3 className="font-semibold mb-4 text-gray-700">Applicant Cards</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {scoredData.map((a, i) => (
                          <ApplicantCard key={i} applicant={a} onSelect={setSelectedApplicant}/>
                        ))}
                      </div>
                    </div>
                  ) : (
                    <div className="text-center py-12 text-gray-500">
                      <div className="flex justify-center">
                        <ChartIcon />
                      </div>
                      <p className="mt-4">No results yet. Process some applications first!</p>
                    </div>
                  )}
                </div>
              </div>
            )}
            {activeTab === 'table' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-6 sm:p-8">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-6 text-gray-800">Sortable Rankings</h2>
                  {scoredData.length > 0 ? (
                    <>
                      <div className="md:hidden space-y-3">
                        {scoredData.map((a, idx) => (
                          <div key={idx} className="bg-white rounded-lg p-4 shadow hover-lift"
                               onDoubleClick={() => setSelectedApplicant(a)}>
                            <div className="flex justify-between items-start">
                              <div className="min-w-0">
                                <p className="text-xs text-gray-500">Rank #{idx + 1}</p>
                                <p className="font-semibold text-gray-800 truncate">{a.name}</p>
                                <p className="text-sm text-gray-600 truncate">{a.medical_school}</p>
                              </div>
                              <span className={`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap
                                ${a.recommendation === 'Strong Accept' ? 'bg-green-100 text-green-800' :
                                   a.recommendation === 'Accept' ? 'bg-blue-100 text-blue-800' :
                                   a.recommendation === 'Hold' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
                                {a.recommendation}
                              </span>
                            </div>
                            <div className="mt-3 grid grid-cols-3 gap-2 text-sm">
                              <div><span className="text-gray-500">Step1</span><div className="font-medium">{a.step1 ?? 'N/A'}</div></div>
                              <div><span className="text-gray-500">Step2</span><div className="font-medium">{a.step2 ?? 'N/A'}</div></div>
                              <div><span className="text-gray-500">Score</span><div className="font-medium">{a.rubric_total}</div></div>
                            </div>
                            <div className="mt-3">
                              <button className="w-full px-3 py-2 bg-purple-600 text-white rounded-lg font-medium"
                                      onClick={() => setSelectedApplicant(a)}>
                                View Details
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                      <div className="overflow-x-auto hidden md:block">
                        <table className="w-full border-collapse">
                          <thead>
                            <tr className="border-b-2 border-gray-200">
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('rubric_total')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Rank</span><SortArrow column="rubric_total" />
                                </button>
                              </th>
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('name')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Name</span><SortArrow column="name" />
                                </button>
                              </th>
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('medical_school')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Medical School</span><SortArrow column="medical_school" />
                                </button>
                              </th>
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('step1')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Step 1</span><SortArrow column="step1" />
                                </button>
                              </th>
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('step2')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Step 2</span><SortArrow column="step2" />
                                </button>
                              </th>
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('publications')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Pubs</span><SortArrow column="publications" />
                                </button>
                              </th>
                              <th className="text-left p-3">
                                <button onClick={() => handleSort('rubric_total')}
                                  className="flex items-center space-x-1 font-semibold text-gray-700 hover:text-purple-600">
                                  <span>Total Score</span><SortArrow column="rubric_total" />
                                </button>
                              </th>
                              <th className="text-left p-3">Recommendation</th>
                            </tr>
                          </thead>
                          <tbody>
                            {scoredData.map((a, idx) => (
                              <tr
                                key={idx}
                                className="border-b hover:bg-purple-50 cursor-pointer transition-colors"
                                onDoubleClick={() => setSelectedApplicant(a)}
                                onClick={() => setSelectedApplicant(a)}
                              >
                                <td className="p-3 font-medium">{idx + 1}</td>
                                <td className="p-3">{a.name}</td>
                                <td className="p-3">{a.medical_school}</td>
                                <td className="p-3">{a.step1 ?? 'N/A'}</td>
                                <td className="p-3">{a.step2 ?? 'N/A'}</td>
                                <td className="p-3">{a.publications}</td>
                                <td className="p-3">
                                  <div className="flex items-center space-x-2">
                                    <span className="font-semibold">{a.rubric_total}</span>
                                    <div className="w-24 bg-gray-200 rounded-full h-2">
                                      <div
                                        className="h-2 rounded-full bg-gradient-to-r from-purple-500 to-purple-600"
                                        style={{ width: `${a.rubric_total}%` }}
                                      />
                                    </div>
                                  </div>
                                </td>
                                <td className="p-3">
                                  <span
                                    className={`px-3 py-1 rounded-full text-xs font-medium
                                      ${a.recommendation === 'Strong Accept' ? 'bg-green-100 text-green-800' :
                                         a.recommendation === 'Accept' ? 'bg-blue-100 text-blue-800' :
                                         a.recommendation === 'Hold' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}
                                  >
                                    {a.recommendation}
                                  </span>
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </>
                  ) : (
                    <div className="text-center py-12 text-gray-500">
                      <div className="flex justify-center">
                        <TableIcon />
                      </div>
                      <p className="mt-4">No rankings yet. Process some applications first!</p>
                    </div>
                  )}
                </div>
              </div>
            )}
            {/* Rotations Tab with Updated Drag-and-Drop */}
            {activeTab === 'rotations' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-4 sm:p-8">
                  <div className="flex flex-col md:flex-row md:justify-between md:items-center gap-3 mb-4 sm:mb-6">
                    <h2 className="text-xl sm:text-2xl font-semibold text-gray-800">Rotation Calendar</h2>
                    <div className="flex flex-col md:flex-row gap-2">
                      <button
                        onClick={exportRotationSchedule}
                        className="w-full md:w-auto px-4 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center justify-center space-x-2">
                        <DownloadIcon /><span>Export Schedule</span>
                      </button>
                      <div className="flex items-center gap-4">
  <label className={`flex items-center gap-3 cursor-pointer select-none ${
    lockAccepted ? 'text-gray-800' : 'text-gray-600'
  }`}>
    <input 
      type="checkbox" 
      className="h-5 w-5 accent-indigo-600 align-middle"
      checked={lockAccepted} 
      onChange={e => setLockAccepted(e.target.checked)} 
    />
    <span className="leading-none">Lock accepted</span>
  </label>
  <label className="flex items-center gap-2 text-sm text-gray-700">
    Capacity:
    <input
      type="number"
      min="1"
      className="w-20 border rounded px-2 py-1"
      value={capacityPerMonth}
      onChange={e => setCapacityPerMonth(parseInt(e.target.value || '1', 10))}
    />
  </label>
</div>
                    </div>
                  </div>
                  {matchingStats && (
                    <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 mb-4 sm:mb-6">
                      <h3 className="font-semibold mb-3 text-gray-700">Matching Statistics</h3>
                      <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <div><p className="text-xs text-gray-600">1st Choice</p><p className="text-xl sm:text-2xl font-bold text-green-600">{matchingStats.firstChoice}</p></div>
                        <div><p className="text-xs text-gray-600">2nd Choice</p><p className="text-xl sm:text-2xl font-bold text-blue-600">{matchingStats.secondChoice}</p></div>
                        <div><p className="text-xs text-gray-600">3rd Choice</p><p className="text-xl sm:text-2xl font-bold text-yellow-600">{matchingStats.thirdChoice}</p></div>
                        <div><p className="text-xs text-gray-600">Unmatched</p><p className="text-xl sm:text-2xl font-bold text-red-600">{matchingStats.unmatched}</p></div>
                      </div>
                    </div>
                  )}
                  <div className="md:hidden sticky top-[64px] z-20">
                    <div className="bg-white/90 backdrop-blur-md border rounded-lg p-2 flex items-center justify-between">
                      <button
                        className="px-3 py-2 rounded-lg bg-gray-100"
                        onClick={() => setMobileMonthIdx(Math.max(mobileMonthIdx - 1, 0))}
                        disabled={mobileMonthIdx === 0}
                      >
                        <ChevronLeft />
                      </button>
                      <div className="flex-1 px-2">
                        <select
                          className="w-full border rounded-lg px-3 py-2"
                          value={months[mobileMonthIdx]}
                          onChange={(e) => setMobileMonthIdx(months.indexOf(e.target.value))}
                        >
                          {months.map((m, i) => <option key={i} value={m}>{m}</option>)}
                        </select>
                      </div>
                      <button
                        className="px-3 py-2 rounded-lg bg-gray-100"
                        onClick={() => setMobileMonthIdx(Math.min(mobileMonthIdx + 1, months.length - 1))}
                        disabled={mobileMonthIdx === months.length - 1}
                      >
                        <ChevronRight />
                      </button>
                    </div>
                  </div>
                  <div className="md:hidden mt-4 space-y-4">
                    {(() => {
                      const month = months[mobileMonthIdx];
                      const arr = rotationAssignments[month] || [];
                      return (
                        <div>
                          <h3 className="text-lg font-semibold text-gray-800 mb-3">{month}</h3>
                          {Array.from({ length: capacityPerMonth }).map((_, index) => {
                            const student = arr[index];
                            const moved = student ? isMoved(student, month, index) : false;
                            return (
                              <div key={`${month}-mobile-${index}`}
                                   className={`border rounded-xl p-4 mb-3 bg-white ${moved ? 'border-red-500 ring-1 ring-red-400' : ''}`}
                                   onDoubleClick={() => student && setSelectedApplicant(student)}>
                                <div className="flex items-start justify-between">
                                  <div className="min-w-0">
                                    <p className="text-xs text-gray-500 mb-1">Slot {index + 1}</p>
                                    {student ? (
                                      <Fragment>
                                        <p className="font-semibold text-gray-800 truncate">
                                          {student.name.split(' ').map(n => n[0]).join('')} — {student.name}
                                        </p>
                                        <div className="mt-1 flex flex-wrap gap-2 items-center">
                                          <span className={`text-xs px-2 py-1 rounded-full
                                            ${student.invitation_status === 'accepted' ? 'bg-green-100 text-green-800' :
                                               student.invitation_status === 'invited' ? 'bg-blue-100 text-blue-800' :
                                               student.invitation_status === 'waitlist' ? 'bg-yellow-100 text-yellow-800' :
                                               student.invitation_status === 'declined' ? 'bg-red-100 text-red-800' :
                                               'bg-gray-100 text-gray-800'}`}>
                                            {student.invitation_status}
                                          </span>
                                          {(() => {
                                            const pi = (student.rotation_preferences || []).indexOf(month);
                                            return pi > -1 && (
                                              <span className={`text-xs ${pi===0?'text-green-600':pi===1?'text-blue-600':'text-yellow-600'}`}>
                                                {pi===0?'1st':pi===1?'2nd':'3rd'} choice
                                              </span>
                                            );
                                          })()}
                                        </div>
                                      </Fragment>
                                    ) : (
                                      <p className="text-gray-400">Empty</p>
                                    )}
                                  </div>
                                  {student && moved && (
                                    <button
                                      title="Revert to original slot"
                                      onClick={() => handleRevertToOriginal(student.applicant_id)}
                                      className="text-red-600 font-bold leading-none px-2"
                                    >
                                      x
                                    </button>
                                  )}
                                </div>
                                {student && (
                                  <div className="mt-3 space-y-2">
                                    {expandedCardId === student.applicant_id ? (
                                      <div className="text-sm text-gray-700 space-y-1">
                                        <p><span className="text-gray-500">Email:</span> {student.email}</p>
                                        <p><span className="text-gray-500">School:</span> {student.medical_school}</p>
                                        <p><span className="text-gray-500">Scores:</span> Step1 {student.step1 ?? 'N/A'} • Step2 {student.step2 ?? 'N/A'}</p>
                                        <p><span className="text-gray-500">Rubric Total:</span> {student.rubric_total}/100</p>
                                      </div>
                                    ) : null}
                                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                      <button
                                        className="w-full px-3 py-2 bg-gray-100 rounded-lg"
                                        onClick={() => setExpandedCardId(expandedCardId === student.applicant_id ? null : student.applicant_id)}
                                      >
                                        {expandedCardId === student.applicant_id ? 'Hide' : 'More'} Details
                                      </button>
                                      <button
                                        className="w-full px-3 py-2 bg-indigo-600 text-white rounded-lg"
                                        onClick={() => setSelectedApplicant(student)}
                                      >
                                        Open Profile
                                      </button>
                                      <button
                                        className="w-full px-3 py-2 bg-purple-600 text-white rounded-lg"
                                        onClick={() => setShowMoveFor({ applicant: student, fromMonth: month, fromIndex: index })}
                                      >
                                        Reassign
                                      </button>
                                    </div>
                                  </div>
                                )}
                              </div>
                            );
                          })}
                        </div>
                      );
                    })()}
                  </div>
                  {/* Updated Desktop/Tablet Grid View with Drag-and-Drop */}
                  <div className="hidden md:block overflow-x-auto mt-6">
                    <div className="min-w-max">
                      <div className="grid" style={{ gridTemplateColumns: `auto repeat(${months.length}, 1fr)`}}>
                        <div className="font-semibold text-gray-700 p-2">Slot</div>
                        {months.map(month => (
                          <div key={month} className="font-semibold text-center text-gray-700 p-2 border-b-2 border-gray-200">
                            {month}
                          </div>
                        ))}
                        {Array.from({ length: capacityPerMonth }).map((_, slotIndex) => (
                          <Fragment key={slotIndex}>
                            <div className="text-gray-600 p-2">Slot {slotIndex + 1}</div>
                            {months.map(month => {
                              const student = rotationAssignments[month]?.[slotIndex];
                              const moved = student ? isMoved(student, month, slotIndex) : false;
                              const isLocked = lockAccepted && student?.invitation_status === 'accepted';
                              return (
                                <div
                                  key={`${month}-${slotIndex}`}
                                  onDragOver={(e) => handleDragOver(month, slotIndex, student, e)}
                                  onDragLeave={handleDragLeave}
                                  onDrop={(e) => handleDrop(month, slotIndex, student, e)}
                                  className={`border rounded-lg p-2 min-h-[88px] transition-all hover:shadow-md cursor-pointer
                                    ${student ? 'bg-white' : 'bg-gray-50 border-dashed'} ${moved ? 'border-red-500 ring-1 ring-red-400' : ''}`}
                                  aria-label={student ? `Slot for ${student.name} in ${month}` : `Empty slot in ${month}`}
                                >
                                  {student ? (
                                    <div
                                      draggable={!isLocked}
                                      onDragStart={(e) => !isLocked && handleDragStart(student, month, slotIndex, e)}
                                      onDragEnd={handleDragEnd}
                                      onDoubleClick={() => setSelectedApplicant(student)}
                                      className="h-full"
                                      aria-label={`Drag ${student.name} from ${month} slot ${slotIndex + 1}`}
                                    >
                                      <div className="flex items-start justify-between">
                                        <p className="text-sm font-medium text-gray-800 truncate pr-2" title={student.name}>
                                          {student.name.split(' ').map(n => n[0]).join('')} - {student.name.split(' ')[1]}
                                        </p>
                                        {moved && (
                                          <button
                                            title="Revert to original slot"
                                            onClick={(e) => { e.stopPropagation(); handleRevertToOriginal(student.applicant_id); }}
                                            className="text-red-600 font-bold leading-none"
                                            aria-label={`Revert ${student.name} to original slot`}
                                          >
                                            x
                                          </button>
                                        )}
                                      </div>
                                      <div className="mt-1 flex items-center justify-between">
                                        <span className={`text-xs px-2 py-1 rounded-full inline-block
                                          ${student.invitation_status === 'accepted' ? 'bg-green-100 text-green-800' :
                                             student.invitation_status === 'invited' ? 'bg-blue-100 text-blue-800' :
                                             student.invitation_status === 'declined' ? 'bg-red-100 text-red-800' :
                                             student.invitation_status === 'waitlist' ? 'bg-yellow-100 text-yellow-800' :
                                             'bg-gray-100 text-gray-800'}`}>
                                          {student.invitation_status}
                                        </span>
                                        {(() => {
                                          const pi = (student.rotation_preferences || []).indexOf(month);
                                          return pi > -1 && (
                                            <span className={`text-xs ${pi===0?'text-green-600':pi===1?'text-blue-600':'text-yellow-600'}`}>
                                              {pi===0?'1st':pi===1?'2nd':'3rd'} choice
                                            </span>
                                          );
                                        })()}
                                      </div>
                                    </div>
                                  ) : (
                                    <div className="text-gray-400 text-sm text-center mt-4">Empty</div>
                                  )}
                                </div>
                              );
                            })}
                          </Fragment>
                        ))}
                      </div>
                    </div>
                  </div>
                  <div className="mt-6 p-4 border rounded-lg">
                    <div className="flex items-center justify-between gap-3 flex-wrap">
                      <div>
                        <h3 className="font-semibold mb-1 text-gray-700">Matching Algorithm</h3>
                        <p className="text-sm text-gray-600">
                          Priority-based placement by score with 1st/2nd/3rd preference consideration. Accepted students can be locked.
                        </p>
                      </div>
                      <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto">
                        <button
                          onClick={() => {
                            if (!Array.isArray(scoredData) || scoredData.length === 0) {
                              addLog('Cannot re-run: no scored applicants yet.', 'warning');
                              return;
                            }
                            prevAssignmentsRef.current = JSON.parse(JSON.stringify(rotationAssignments || {}));
                            prevStatsRef.current = matchingStats ? { ...matchingStats } : null;
                            setCanRevert(true);
                            addLog('Re-running matching algorithm…', 'info');
                            runMatchingAlgorithm(scoredData);
                          }}
                          className="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg font-medium hover:bg-purple-200 transition-colors w-full sm:w-auto"
                        >
                          Re-run Matching Algorithm
                        </button>
                        <button
                          onClick={handleRevertSchedule}
                          disabled={!canRevert}
                          className={`px-4 py-2 rounded-lg font-medium transition-colors w-full sm:w-auto ${canRevert ? 'bg-gray-100 text-gray-700 hover:bg-gray-200' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}
                        >
                          Revert
                        </button>
                      </div>
                    </div>
                  </div>
                  {showMoveFor && (
                    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowMoveFor(null)}>
                      <div className="bg-white rounded-xl p-4 w-full max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-semibold mb-3">Reassign {showMoveFor.applicant.name}</h3>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                          <div>
                            <label className="text-sm text-gray-600">To Month</label>
                            <select id="move-month" className="mt-1 w-full border rounded-lg px-3 py-2">
                              {months.map((m, i) => <option key={i} value={m}>{m}</option>)}
                            </select>
                          </div>
                          <div>
                            <label className="text-sm text-gray-600">To Slot</label>
                            <select id="move-slot" className="mt-1 w-full border rounded-lg px-3 py-2">
                              {Array.from({ length: capacityPerMonth }).map((_, i) => <option key={i+1} value={i}>Slot {i+1}</option>)}
                            </select>
                          </div>
                        </div>
                        <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2">
                          <button
                            className="w-full px-4 py-2 rounded-lg bg-gray-100"
                            onClick={() => setShowMoveFor(null)}
                          >Cancel</button>
                          <button
                            className="w-full px-4 py-2 rounded-lg bg-purple-600 text-white"
                            onClick={() => {
                              const toMonth = document.getElementById('move-month').value;
                              const toIndex = parseInt(document.getElementById('move-slot').value, 10);
                              performMove(showMoveFor.applicant, showMoveFor.fromMonth, showMoveFor.fromIndex, toMonth, toIndex);
                            }}
                          >Move</button>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
            {/* Bias Mitigation */}
            {activeTab === 'bias' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-6 sm:p-8">
                  <div className="flex items-center gap-2 mb-6">
                    <ShieldIcon />
                    <h3 className="text-xl sm:text-2xl font-semibold text-gray-800">Bias Mitigation</h3>
                  </div>
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div className="bg-white rounded-lg p-4 border">
                      <h3 className="font-semibold text-gray-800 mb-4">Verify Rank</h3>
                      <div className="space-y-3 mb-4">
                        <label
                          className={`flex items-center gap-3 cursor-pointer select-none ${
                            biasChecks.missingStep2 ? 'text-gray-800' : 'text-gray-600'
                          }`}
                        >
                          <input
                            type="checkbox"
                            className="h-5 w-5 accent-indigo-600 align-middle"
                            checked={biasChecks.missingStep2}
                            onChange={(e) =>
                              setBiasChecks({ ...biasChecks, missingStep2: e.target.checked })
                            }
                          />
                          <span className="leading-none">
                            Neutral weighting for missing Step 2
                          </span>
                        </label>
                        <label
                          className={`flex items-center gap-3 cursor-pointer select-none ${
                            biasChecks.normalizeScores ? 'text-gray-800' : 'text-gray-600'
                          }`}
                        >
                          <input
                            type="checkbox"
                            className="h-5 w-5 accent-indigo-600 align-middle"
                            checked={biasChecks.normalizeScores}
                            onChange={(e) =>
                              setBiasChecks({ ...biasChecks, normalizeScores: e.target.checked })
                            }
                          />
                          <span className="leading-none">
                            Normalize subjective subscores across reviewers
                          </span>
                        </label>
                        <label
                          className={`flex items-center gap-3 cursor-pointer select-none ${
                            biasChecks.calculateBias ? 'text-gray-800' : 'text-gray-600'
                          }`}
                        >
                          <input
                            type="checkbox"
                            className="h-5 w-5 accent-indigo-600 align-middle"
                            checked={biasChecks.calculateBias}
                            onChange={(e) =>
                              setBiasChecks({ ...biasChecks, calculateBias: e.target.checked })
                            }
                          />
                          <span className="leading-none">
                            Run distribution/bias probability checks
                          </span>
                        </label>
                      </div>
                      <button
                        onClick={runBiasVerification}
                        className="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors"
                      >
                        {biasCalculating ? 'Running…' : 'Run Checks'}
                      </button>
                    </div>
                    <div className="bg-white rounded-lg p-4 border">
                      <h3 className="font-semibold text-gray-800 mb-4">Results</h3>
                      {!biasResults && !biasCalculating && (
                        <p className="text-gray-500">Select options and run checks to see results.</p>
                      )}
                      {biasCalculating && (
                        <p className="text-gray-500 animate-pulse-slow">Analyzing…</p>
                      )}
                      {biasResults && (
                        <div className="space-y-3 text-sm">
                          {biasResults.missingStep2 && (
                            <div className="p-3 rounded bg-blue-50 border border-blue-200">
                              <div className="font-semibold text-blue-900 mb-1">Missing Step 2</div>
                              <div className="text-blue-800">{biasResults.missingStep2.message}</div>
                            </div>
                          )}
                          {biasResults.normalizeScores && (
                            <div className="p-3 rounded bg-yellow-50 border border-yellow-200">
                              <div className="font-semibold text-yellow-900 mb-1">Normalization</div>
                              <div className="text-yellow-800">{biasResults.normalizeScores.message}</div>
                            </div>
                          )}
                          {biasResults.calculateBias && (
                            <div className="p-3 rounded bg-green-50 border border-green-200">
                              <div className="font-semibold text-green-900 mb-1">Bias Scan</div>
                              <div className="text-green-800">{biasResults.calculateBias.message}</div>
                            </div>
                          )}
                          {biasResults.summary && (
                            <div className="p-3 rounded bg-gray-50 border">
                              <div className="font-semibold text-gray-900 mb-1">{biasResults.summary.overallStatus}</div>
                              <div className="text-gray-800">{biasResults.summary.recommendation}</div>
                              <ul className="list-disc ml-5 mt-2 text-gray-700">
                                {biasResults.summary.nextSteps.map((s, i) => <li key={i}>{s}</li>)}
                              </ul>
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            )}
            {/* Export */}
            {activeTab === 'export' && (
              <div className="animate-slide-in">
                <div className="glass-morphism rounded-xl p-6 sm:p-8">
                  <h2 className="text-xl sm:text-2xl font-semibold mb-6 text-gray-800">Export Results</h2>
                  <div className="space-y-4 sm:space-y-6">
                    <div className="border rounded-lg p-4 sm:p-6 hover-lift cursor-pointer hover:border-purple-400 transition-all">
                      <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                        <div>
                          <h3 className="font-semibold text-lg text-gray-800 mb-2">Excel Workbook</h3>
                          <p className="text-gray-600 mb-3 sm:mb-4">
                            Complete results with Master List, Ranked View, Red Flags, and Audit trail
                          </p>
                          <div className="text-sm text-gray-500 space-y-1">
                            <p>• Master_List - All applicant data</p>
                            <p>• Ranked_View - Sorted by total score</p>
                            <p>• Red_Flags - Flagged issues</p>
                            <p>• Audit - Processing metadata</p>
                          </div>
                        </div>
                        <button className="w-full sm:w-auto px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center space-x-2" onClick={exportExcelWorkbook}>
                          <DownloadIcon /><span>Download</span>
                        </button>
                      </div>
                    </div>
                    <div className="border rounded-lg p-4 sm:p-6 hover-lift cursor-pointer hover:border-purple-400 transition-all">
                      <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                        <div>
                          <h3 className="font-semibold text-lg text-gray-800 mb-2">JSON Export</h3>
                          <p className="text-gray-600 mb-3 sm:mb-4">Raw structured data in JSON & JSON Lines format</p>
                          <div className="text-sm text-gray-500 space-y-1">
                            <p>• VSLO_Full_Export.json - All data in one file</p>
                            <p>• VSLO_Scored.jsonl - Scored data, one record per line</p>
                          </div>
                        </div>
                        <button className="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2" onClick={exportJSON}>
                          <DownloadIcon /><span>Download</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
          {/* Applicant Modal */}
          {selectedApplicant && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setSelectedApplicant(null)}>
              <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h2 className="text-xl sm:text-2xl font-bold text-gray-800">{selectedApplicant.name}</h2>
                    <p className="text-gray-600 break-all">{selectedApplicant.email}</p>
                    <p className="text-sm text-gray-500">{selectedApplicant.medical_school} • Class of {selectedApplicant.graduation_year}</p>
                  </div>
                  <button onClick={() => setSelectedApplicant(null)} className="text-gray-400 hover:text-gray-600 text-2xl">✕</button>
                </div>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-2 text-gray-700">Test Scores</h3>
                    <p>Step 1: {selectedApplicant.step1 ?? 'N/A'}</p>
                    <p>Step 2 CK: {selectedApplicant.step2 ?? 'N/A'}</p>
                  </div>
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-2 text-gray-700">Application Stats</h3>
                    <p>Experiences: {selectedApplicant.experiences}</p>
                    <p>Publications: {selectedApplicant.publications}</p>
                    <p>Honors: {selectedApplicant.honors}</p>
                  </div>
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-2 text-gray-700">Preferences</h3>
                    <p>{(selectedApplicant.rotation_preferences || []).join(' • ') || '—'}</p>
                  </div>
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-2 text-gray-700">Status</h3>
                    <p className="capitalize">{selectedApplicant.invitation_status || '—'}</p>
                  </div>
                  <div className="bg-gray-50 p-4 rounded-lg sm:col-span-2">
                    <h3 className="font-semibold mb-2 text-gray-700">Rubric Scores</h3>
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                      <div><p className="text-sm text-gray-500">Academics</p><p className="font-semibold">{selectedApplicant.academics}/25</p></div>
                      <div><p className="text-sm text-gray-500">Letters</p><p className="font-semibold">{selectedApplicant.letters}/25</p></div>
                      <div><p className="text-sm text-gray-500">Fit & Interest</p><p className="font-semibold">{selectedApplicant.fit_interest}/25</p></div>
                      <div><p className="text-sm text-gray-500">Professionalism</p><p className="font-semibold">{selectedApplicant.professionalism}/25</p></div>
                    </div>
                    <div className="mt-4 pt-4 border-t">
                      <div className="flex justify-between items-center">
                        <span className="font-semibold">Total Score:</span>
                        <span className="text-xl font-bold text-purple-600">{selectedApplicant.rubric_total}/100</span>
                      </div>
                      <div className="flex justify-between items-center mt-2">
                        <span className="font-semibold">Recommendation:</span>
                        <span className={`px-3 py-1 rounded-full text-sm font-medium
                          ${selectedApplicant.recommendation === 'Strong Accept' ? 'bg-green-100 text-green-800' :
                             selectedApplicant.recommendation === 'Accept' ? 'bg-blue-100 text-blue-800' :
                             selectedApplicant.recommendation === 'Hold' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
                          {selectedApplicant.recommendation}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}
          {/* Footer */}
          <footer className="bg-purple-100 border-t border-purple-200 mt-auto">
            <div className="container mx-auto px-4 sm:px-6 py-4">
              <div className="flex flex-col sm:flex-row items-center justify-center gap-2">
                <p className="text-sm sm:text-base text-gray-700 text-center">
                  Created by Brian Pitts, M.D., M.S., MEHP | Department of Anesthesiology and Pain Medicine, UC Davis Health 2025 |
                </p>
                <button
                  onClick={() => setShowAboutModal(true)}
                  className="text-purple-600 hover:text-purple-700 transition-colors flex items-center gap-1"
                >
                  <span>About</span>
                  <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                  </svg>
                </button>
              </div>
            </div>
          </footer>
          {/* About Modal */}
          {showAboutModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowAboutModal(false)}>
              <div className="bg-white rounded-xl p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-start mb-4">
                  <h2 className="text-2xl font-bold text-gray-800">About the VSLO Application Processing System</h2>
                  <button onClick={() => setShowAboutModal(false)} className="text-gray-400 hover:text-gray-600 text-2xl">✕</button>
                </div>
                <div className="space-y-6 text-gray-700">
                  <div>
                    <h3 className="text-lg font-semibold mb-2 text-purple-700">The Problem</h3>
                    <p className="leading-relaxed">
                      Reviewing VSLO (Visiting Student Learning Opportunities) and ERAS (Electronic Residency Application Service) applications is an essential but time-intensive process for faculty. Each application packet can span dozens of pages, with critical details—board scores, academic performance, publications, recommendation letters—buried inside PDFs. Manually extracting this information is laborious, prone to inconsistencies, and can inadvertently introduce reviewer bias or variability in scoring.
                    </p>
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold mb-2 text-purple-700">What It Does</h3>
                    <p className="leading-relaxed">
                      The system automatically ingests ERAS/VSLO application PDFs, extracts structured information, and generates standardized applicant scorecards. It provides quick access to objective metrics, transparent rubric-based scoring, and visual summaries that make it easier for faculty to compare candidates at a glance. This allows faculty to focus their attention on holistic review and meaningful decision-making, rather than data entry.
                    </p>
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold mb-2 text-purple-700">How It Works</h3>
                    <ul className="list-disc pl-5 space-y-2 leading-relaxed">
                      <li><strong>Automated Extraction</strong>: Uses PDF parsing tools to reliably identify and capture relevant fields (exam scores, demographics, education, publications, personal statements).</li>
                      <li><strong>Rubric-Based Scoring</strong>: Applies a customizable scoring framework that weights academic, professional, and experiential domains consistently.</li>
                      <li><strong>User Interface</strong>: Displays ranked applicants, sortable tables, and individual applicant profiles, while enabling comments and overrides by faculty reviewers.</li>
                      <li><strong>Auditability</strong>: Maintains a clear record of scoring criteria, extracted data, and reviewer notes to support transparency.</li>
                    </ul>
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold mb-2 text-purple-700">Role of Machine Learning</h3>
                    <p className="leading-relaxed mb-2">Machine learning models support tasks such as:</p>
                    <ul className="list-disc pl-5 space-y-1">
                      <li>Improving extraction accuracy from variable PDF layouts.</li>
                      <li>Identifying text signals (e.g., professionalism, leadership) aligned with rubric categories.</li>
                      <li>Providing trend analysis and bias detection reports.</li>
                    </ul>
                    <p className="leading-relaxed mt-3">
                      Importantly, the models are trained and tuned with a focus on <strong>fairness and transparency</strong>. Built-in safeguards monitor for systematic bias (e.g., differences across demographic groups), and outputs are always traceable back to their data sources.
                    </p>
                  </div>
                  <div>
                    <h3 className="text-lg font-semibold mb-2 text-purple-700">Human in the Loop</h3>
                    <p className="leading-relaxed">
                      This system does not replace faculty judgment. Instead, it <strong>augments the review process</strong> by reducing clerical burden and standardizing the information presented. Final decisions about acceptance, ranking, or rejection remain firmly with the human reviewers. Faculty can override, annotate, or disregard automated suggestions at any time. The guiding principle is <em>decision support, not decision replacement</em>.
                    </p>
                  </div>
                  <div className="mt-6 pt-4 border-t">
                    <div className="flex justify-center">
                      <a
                        href="https://physicians.ucdavis.edu/details/980/brian-pitts-anesthesiology-sacramento"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-purple-600 hover:text-purple-700 transition-colors flex items-center gap-2"
                      >
                        <span>View Dr. Pitts' Profile</span>
                        <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                          <path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<VSLOApp />);
  </script>
  <script>
    window.addEventListener('error', (e) => {
      console.error('Runtime error:', e.error || e.message);
    });
  </script>
</body>
</html>
